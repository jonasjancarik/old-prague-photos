<!doctype html>
<html lang="cs">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Staré fotografie Prahy</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,700&family=Space+Grotesk:wght@400;500;600&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="page">
    <header class="topbar">
      <div>
        <p class="eyebrow">Archivní prohlížeč</p>
        <h1>Staré fotografie Prahy</h1>
        <p class="subtitle">
          Geolokalizované fotografie z archivu hlavního města Prahy. Toto není oficiální projekt hlavního města Prahy.
        </p>
        <div class="topbar-actions">
          <button class="secondary" type="button" id="info-open">O co jde</button>
          <a class="action-link" href="./pomoc.html">Chci pomoct s opravami</a>
        </div>
      </div>
      <div class="topbar-meta">
        <div class="stat">
          <span class="stat-label">Zmapované snímky</span>
          <span class="stat-value" id="photo-count">—</span>
        </div>
        <div class="stat">
          <span class="stat-label">Ověřeno komunitou</span>
          <span class="stat-value" id="verified-count">—</span>
        </div>
      </div>
    </header>

    <main class="content">
      <div class="map-toolbar">
        <div class="search-container">
          <input type="text" id="map-search" placeholder="Hledat adresu nebo místo..." aria-label="Hledat na mapě" />
          <div id="search-results" class="search-results is-hidden"></div>
        </div>
        <div class="cluster-toggle-container">
          <label class="toggle-switch">
            <input type="checkbox" id="cluster-toggle" checked />
            <span class="toggle-slider"></span>
          </label>
          <span class="toggle-label">Seskupovat fotografie</span>
        </div>
      </div>
      <section class="map-panel">
        <div id="map" aria-label="Mapa s polohami fotografií"></div>
        <div class="map-overlay">
          <div class="chip">Klikněte na bod pro fotografii</div>
        </div>
      </section>
    </main>
  </div>

  <!-- Info Modal -->
  <div class="modal" id="info-modal" aria-hidden="true">
    <div class="modal-backdrop" data-info-close></div>
    <div class="modal-dialog info-dialog" role="dialog" aria-modal="true" aria-label="O projektu">
      <div class="modal-header">
        <div>
          <p class="modal-eyebrow">Informace</p>
          <h2 class="modal-title">Jak to funguje</h2>
        </div>
        <button class="modal-close" type="button" data-info-close>
          Zavřít
        </button>
      </div>
      <div class="modal-body info-body">
        <div class="card info-card">
          <p class="how-lead">
            Z archivu jsme nasbírali cca 10&nbsp;000 záznamů. Část jde geokódovat rovnou (adresa / č.p.) přes Mapy.cz.
            Zbytek nejdřív projde LLM, které z popisu vytáhne kandidátní místa.
          </p>
          <ul class="how-list">
            <li><strong>Výsledek:</strong> dataset s GPS souřadnicemi pro mapu.</li>
            <li><strong>Opravy:</strong> vaše nahlášení se ukládá a po schválení se projeví všem.</li>
            <li><strong>Cíl:</strong> Vytvořit co nejpřesnější mapu historických fotografií Prahy.</li>
          </ul>
          <div class="info-footer">
            <p>Tento projekt je komunitní a open-source. Data pocházejí z Archivu hlavního města Prahy.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal" id="archive-modal" aria-hidden="true">
    <div class="modal-backdrop" data-modal-close></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-label="Archivní záznam">
      <div class="modal-header">
        <div>
          <!-- <p class="modal-eyebrow">Archivní záznam</p>
            <h2 class="modal-title">Náhled stránky</h2> -->
        </div>
        <button class="modal-close" type="button" data-modal-close>
          Zavřít
        </button>
      </div>
      <div class="modal-body">
        <div class="modal-frame">
          <div class="modal-main">
            <div class="zoom-wrap">
              <div id="zoom-viewer" class="zoom-viewer" aria-label="Náhled fotografie"></div>
              <iframe id="archive-iframe" title="Archivní záznam" loading="lazy" referrerpolicy="no-referrer"></iframe>
            </div>

            <aside class="modal-sidebar" id="modal-sidebar" aria-label="Detaily a opravy">
              <!-- Meta view -->
              <div class="modal-meta" id="modal-meta-view">
                <div class="modal-meta-head">
                  <p class="modal-meta-eyebrow">Detaily</p>
                  <h3 class="modal-meta-title">Informace o fotografii</h3>
                </div>
                <div id="photo-details" class="detail-list"></div>

                <div class="report-cta-container">
                  <div class="report-cta" id="report-cta-container">
                    <div class="report-meta">
                      <p class="report-eyebrow">Zpětná vazba</p>
                      <h2 class="report-title">Netrefili jsme to?</h2>
                      <p class="report-subtitle">
                        Je fotografie špatně umístěna?
                      </p>
                    </div>
                    <button class="primary report-button" type="button" id="report-cta">
                      Opravit polohu
                    </button>
                  </div>
                </div>
              </div>

              <!-- Correction view -->
              <div class="modal-correction is-hidden" id="modal-correction-view">
                <div class="modal-meta-head">
                  <p class="modal-meta-eyebrow">Oprava polohy</p>
                  <h3 class="modal-meta-title">Zadejte správné místo</h3>
                </div>

                <form id="feedback-form" class="is-open"> <!-- form stays open in its container -->
                  <input type="hidden" name="issue" value="wrong_location" />
                  <input type="hidden" name="correction_lat" />
                  <input type="hidden" name="correction_lon" />

                  <div class="correction-picker">
                    <p class="helper">Přetáhněte špendlík na mapě na správné místo.</p>
                    <div id="correction-map" aria-label="Mapa pro opravu polohy"></div>
                  </div>

                  <label class="field">
                    <span>Upřesnění (volitelné)</span>
                    <textarea name="message" rows="2" placeholder="Např. patro, směr focení..."></textarea>
                  </label>

                  <label class="field">
                    <span>E-mail (volitelné)</span>
                    <input name="email" type="email" placeholder="vy@priklad.cz" />
                  </label>

                  <div class="turnstile-wrap">
                    <div id="turnstile"></div>
                    <p class="helper" id="turnstile-note"></p>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="primary" disabled>
                      Uložit polohu
                    </button>
                    <button type="button" class="secondary" id="cancel-correction">
                      Zrušit
                    </button>
                  </div>
                  <p class="form-status" id="form-status"></p>
                </form>
              </div>
            </aside>
          </div>
          <div class="modal-footer">
            <a id="archive-fallback" href="#" target="_blank" rel="noopener">
              Otevřít v archivu
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/openseadragon@4.1.1/build/openseadragon/openseadragon.min.js"></script>
  <script src="./zoomify.js"></script>
  <script src="./photo-meta.js"></script>
  <script src="./correction-ui.js"></script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit&onload=turnstileOnload" async
    defer></script>
  <script src="./app.js"></script>
</body>

</html>